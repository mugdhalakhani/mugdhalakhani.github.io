<html>
<head>
  <title>Periodic Background Cats</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <div class="header">
   <h1> Periodic Background Cats </h1>
  </div>

  <div class="row"> 
    <div class="column">
      <figure id="cat1">
        <img src="" class="cat-image" style="width:100%">
        <figcaption> <div> Updated at: <span class="cat-image-caption"></span><div></figcaption>
      </figure>
  </div>

<script>
  navigator.serviceWorker.register('periodicSync_sw.js');

  navigator.serviceWorker.ready.then(() => {
    console.log('SW registered');
    const catImage = document.querySelector('.cat-image');
 
    fetch("/getACat", {cache: "no-store"})
      .then(response => {
        return response.blob();
      })
      .then(theBlob => {
        const objectUrl = URL.createObjectURL(theBlob);
        catImage.src = objectUrl;
      })
      .catch(() => {
        console.log('Could not fetch');
      });
    
    fetch("/getTimeStamp", {cache: "no-store"})
      .then(async (response) => {
        const responseText = await response.text();
        console.log('response is ' + responseText);
        const catImageCaption = document.querySelector('.cat-image-caption');
        console.log('found spanToUpdate? ' + catImageCaption);
        catImageCaption.textContent = responseText;
      })
      .catch(() => {
        console.log('Could not fetch');
      });
  });

  navigator.serviceWorker.addEventListener('message', event => {
    console.log(event.data.msg, event.data.url);
  });
</script>
</body>
</html>

<html>
<head>
  <title>Periodic Background Cats</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <div class="header">
   <h1> Periodic Background Cats </h1>
  </div>

  <input type="image" src="resources/icons/18.png" class="cat-image" alt="cat picture" style="width:100%" onclick="getACat();">
  <figcaption> <div> Updated at: <span class="cat-image-caption"></span><div></figcaption>

<script>
  function getCatImage() {
    const catImage = document.querySelector('.cat-image');
    fetch('https://cataas.com/c', { cache: 'no-store'})
      .then(response => {
        return response.blob();
      })
      .then(theBlob => {
        const objectUrl = URL.createObjectURL(theBlob);
        console.log('created objecturl as ' + objectUrl);
        catImage.src = objectUrl;
      })
      .catch(() => {
        console.log('Could not fetch');
      });
  }

  function getTimeStamp() {
    fetch("/getTimeStamp", {cache: "no-store"})
      .then(async (response) => {
        const responseText = await response.text();
        console.log('response is ' + responseText);
        const catImageCaption = document.querySelector('.cat-image-caption');
        console.log('found spanToUpdate? ' + catImageCaption);
        catImageCaption.textContent = responseText;
      })
      .catch(() => {
        console.log('Could not fetch');
      });
  }

  function getACat() {
    navigator.serviceWorker.ready.then(() => {
      console.log('SW registered');
      getCatImage();
      getTimeStamp();
    });
  }

  window.onload = () => {
    console.log('registering SW');
    navigator.serviceWorker.register('periodicSync_sw.js');
  }

  navigator.serviceWorker.addEventListener('message', event => {
    console.log(event.data.msg, event.data.url);
  });
</script>
</body>
</html>
